{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}
    {{ block.super }}
    <style>
        .help-box {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .help-box h3 {
            margin-top: 0;
            color: #0066cc;
        }
        .help-box ul {
            margin-bottom: 0;
        }
        .help-box li {
            margin-bottom: 5px;
        }
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .warning-box h3 {
            margin-top: 0;
            color: #856404;
        }
        .json-help {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 5px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
{% endblock %}

{% block content %}
    {% if original.is_global %}
        <div class="help-box">
            <h3>üåç Global Rules Configuration</h3>
            <p><strong>You are editing global rules that will apply to all campaigns unless overridden.</strong></p>
            <ul>
                <li>These rules serve as defaults for all campaigns</li>
                <li>Changes here will affect all campaigns without specific rules</li>
                <li>Only superusers can modify global rules</li>
                <li>Test thoroughly before saving changes</li>
            </ul>
        </div>
    {% else %}
        <div class="help-box">
            <h3>üéØ Campaign-Specific Rules</h3>
            <p><strong>You are creating/editing rules for campaign: {{ original.campaign.name|default:"(Not selected)" }}</strong></p>
            <ul>
                <li>These rules will override global defaults for this campaign only</li>
                <li>Only modify values that need to be different from global rules</li>
                <li>Leave fields unchanged to use global defaults</li>
                <li>Test character creation with these rules before using in play</li>
            </ul>
        </div>
    {% endif %}

    {% if not original.is_global and not original.campaign %}
        <div class="warning-box">
            <h3>‚ö†Ô∏è Important: Select a Campaign</h3>
            <p>You must select a campaign for campaign-specific rules. Global rules should have "Is global" checked instead.</p>
        </div>
    {% endif %}

    {{ block.super }}
{% endblock %}

{% block field_sets %}
    {% for fieldset in adminform %}
        {% if fieldset.name == "Stand Coin Grade Point Costs" %}
            <fieldset class="module aligned {{ fieldset.classes }}">
                <h2>{{ fieldset.name }}</h2>
                {% if fieldset.description %}
                    <div class="description">{{ fieldset.description|safe }}</div>
                {% endif %}
                {% for line in fieldset %}
                    {% for field in line %}
                        <div class="form-row{% if line.fields|length_is:'1' and line.errors %} errors{% endif %}{% for field in line %}{% if field.field.name %} field-{{ field.field.name }}{% endif %}{% endfor %}">
                            {% if not line.fields|length_is:'1' and not field.is_readonly %}{{ field.errors }}{% endif %}
                            {% if field.is_checkbox %}
                                {{ field.field }}{{ field.label_tag }}
                            {% else %}
                                {{ field.label_tag }}
                                {% if field.is_readonly %}
                                    <div class="readonly">{{ field.contents }}</div>
                                {% else %}
                                    {{ field.field }}
                                    <div class="json-help">
                                        Example: {"S": 5, "A": 4, "B": 3, "C": 2, "D": 1, "F": 0}
                                    </div>
                                {% endif %}
                            {% endif %}
                            {% if field.field.help_text %}
                                <p class="help">{{ field.field.help_text|safe }}</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endfor %}
            </fieldset>
        {% elif fieldset.name == "Stand Coin Stat Properties" %}
            <fieldset class="module aligned {{ fieldset.classes }}">
                <h2>{{ fieldset.name }}</h2>
                {% if fieldset.description %}
                    <div class="description">{{ fieldset.description|safe }}</div>
                {% endif %}
                {% for line in fieldset %}
                    {% for field in line %}
                        <div class="form-row{% if line.fields|length_is:'1' and line.errors %} errors{% endif %}{% for field in line %}{% if field.field.name %} field-{{ field.field.name }}{% endif %}{% endfor %}">
                            {% if not line.fields|length_is:'1' and not field.is_readonly %}{{ field.errors }}{% endif %}
                            {% if field.is_checkbox %}
                                {{ field.field }}{{ field.label_tag }}
                            {% else %}
                                {{ field.label_tag }}
                                {% if field.is_readonly %}
                                    <div class="readonly">{{ field.contents }}</div>
                                {% else %}
                                    {{ field.field }}
                                    <div class="json-help">
                                        Complex JSON structure with properties for each grade (S, A, B, C, D, F).<br>
                                        Each grade can have: power, speed, range, durability, precision, development properties.
                                    </div>
                                {% endif %}
                            {% endif %}
                            {% if field.field.help_text %}
                                <p class="help">{{ field.field.help_text|safe }}</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endfor %}
            </fieldset>
        {% else %}
            {{ block.super }}
        {% endif %}
    {% endfor %}
{% endblock %}

{% block extrahead %}
    {{ block.super }}
    {% if show_extra_template %}
        {% include "admin/characters/gamerules/change_form_extra.html" %}
    {% endif %}
{% endblock %} 